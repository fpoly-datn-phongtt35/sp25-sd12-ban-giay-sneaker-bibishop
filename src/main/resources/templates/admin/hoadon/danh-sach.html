<!-- templates/admin/hoadon/danh-sach.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Danh Sách Hóa Đơn</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
  <h2>Danh Sách Hóa Đơn</h2>

  <!-- Bộ lọc trạng thái -->
  <div class="mb-3">
    <label for="filterStatus" class="form-label">Lọc theo trạng thái:</label>
    <select id="filterStatus" class="form-select" onchange="filterOrders()">
      <option value="">Tất cả</option>
      <option value="CHO_XU_LY">Chờ xử lý</option>
      <option value="DANG_XU_LY">Đang xử lý</option>
      <option value="DANG_VAN_CHUYEN">Đang vận chuyển</option>
      <option value="HOAN_THANH">Hoàn thành</option>
      <option value="HUY">Hủy</option>
      <option value="TRA_HANG">Trả hàng</option>
    </select>
  </div>

  <table class="table table-bordered">
    <thead>
    <tr>
      <th>Mã Hóa Đơn</th>
      <th>Khách Hàng</th>
      <th>Ngày Tạo</th>
      <th>Tổng Tiền</th>
      <th>Trạng Thái</th>
      <th>Thao Tác</th>
    </tr>
    </thead>
    <tbody>
<!--    th:if="${hoaDon.loaiHoaDon == 'CHO_XU_LY'}"-->
    <tr th:each="hoaDon : ${danhSachHoaDon}" >
      <td th:text="${hoaDon.id}"></td>
      <td th:text="${hoaDon.maHoaDon}"></td>
      <td th:text="${hoaDon.ngayTao}"></td>
      <td th:text="${hoaDon.tongTien}"></td>
      <td>
        <select class="form-select" th:value="${hoaDon.trangThai}" th:onchange="changeStatus(this, [[${hoaDon.id}]])">
          <option value="CHO_XU_LY">Chờ xử lý</option>
          <option value="DANG_XU_LY">Đang xử lý</option>
          <option value="DANG_VAN_CHUYEN">Đang vận chuyển</option>
          <option value="HOAN_THANH">Hoàn thành</option>
          <option value="HUY">Hủy</option>
          <option value="TRA_HANG">Trả hàng</option>
        </select>
      </td>
      <td>
        <a th:href="@{/admin/hoadon/chitiet/{id}(id=${hoaDon.id})}" class="btn btn-primary">Xử Lý</a>
        <a th:href="@{/admin/hoadon/xoa/{id}(id=${hoaDon.id})}" class="btn btn-danger" onclick="return confirm('Bạn có chắc chắn muốn xóa?')">Xóa</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>
<script>
  function changeStatus(select, id) {
    let status = select.value;
    fetch(`/admin/hoadon/capnhat-trangthai/${id}?status=${status}`, {
      method: 'POST'
    }).then(() => location.reload());
  }

  function filterOrders() {
    let status = document.getElementById("filterStatus").value;
    window.location.href = `/admin/hoadon?trangThai=${status}`;
  }
</script>
</body>
</html>